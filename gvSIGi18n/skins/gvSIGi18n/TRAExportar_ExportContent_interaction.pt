<tal:block replace="nothing">
# File: TRAExportar_ExportContent_interaction.pt
#
# Copyright (c) 2008, 2009 by Conselleria de Infraestructuras y Transporte de la Generalidad Valenciana
#
# GNU General Public License (GPL)
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA.
#
# Authors: 
# Conselleria de Infraestructuras y Transporte de la Generalidad Valenciana 
# Model Driven Development sl  Valencia (Spain) www.ModelDD.org 
# Antonio Carrasco Valero                       carrasco@ModelDD.org
#
#
</tal:block>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<body>








<div metal:define-macro="tExtractParametersFromRequest" >
    <tal:block tal:define="
        pLanguagesToExport python: request.get( 'theLanguagesToExport',        []);
        pLanguagesToExport python: (( pLanguagesToExport and here.fIsCollection( pLanguagesToExport) and pLanguagesToExport) or [ pLanguagesToExport, ]) or [];
        pCodigosIdiomaReferencia python: dict( [ [pCode, request.get( 'ref-%s' % pCode, '') ] for pCode in pLanguagesToExport if request.get( 'ref-%s' % pCode, '')]);
        pCodificacionesCaracteres python: dict( [ [pCode, request.get( 'enc-%s' % pCode, '') ] for pCode in pLanguagesToExport if request.get( 'enc-%s' % pCode, '')]);
        pModulesToExport python: request.get( 'theModulesToExport',        []);
        pModulesToExport python: (( pModulesToExport and here.fIsCollection( pModulesToExport) and pModulesToExport) or [ pModulesToExport, ]) or [];
        void python: pExport_ExportContent_Parameters_input.update( dict( [
            ( 'theExportFormat',            request.get( 'theExportFormat',             None),),
            ( 'theIncludeManifest',         request.get( 'theIncludeManifest',          None),),
            ( 'theIncludeLocalesCSV',         request.get( 'theIncludeLocalesCSV',          None),),
            ( 'theSeparatedModules',        request.get( 'theSeparatedModules',         None),),
            ( 'theTipoArchivo',             request.get( 'theTipoArchivo',              None),),
            ( 'theDefaultLanguageCode',     request.get( 'theDefaultLanguageCode',      None),),
            ( 'theDefaultModuleName',       request.get( 'theDefaultModuleName',        None),),
            ( 'theEncodingErrorHandleMode', request.get( 'theEncodingErrorHandleMode',  None),),
            ( 'theLanguagesToExport',       pLanguagesToExport,),
            ( 'theModulesToExport',         pModulesToExport,),
            ( 'theCodigosIdiomaReferencia', pCodigosIdiomaReferencia,),            
            ( 'theCodificacionesCaracteres',pCodificacionesCaracteres,),            
        ]));" />
</div>






<div metal:define-macro="tExportar_ExportContent_interaction_help" >
    <p>
        <strong>
            <tal:block tal:replace="structure python: here.fCRs2BRs( here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_Exportar_ExportContent_interaction_help',  'If the export process fails, the system will report the errors found.\nIf sucessful, the export process will generate a download archive.\nYour internet browser may offer you the option of saving or opening the download archive.\nPlease save the file, for future use with gvSIG or translation tools.-' ))" />
        </strong>    
    </p>
    <br/>
    <br/>            
</div>



 <div metal:define-macro="tInformErrorDuringExport" >
    <tal:block tal:define="
        pExportContentSuccess python: pExport_ExportContent_report and pExport_ExportContent_report.get( 'success', False);
        pStatus                 python: pExport_ExportContent_report and pExport_ExportContent_report.get( 'status', '');
        pException              python: pExport_ExportContent_report and pExport_ExportContent_report.get( 'exception', '')" 
        tal:condition="not: pExportContentSuccess">

        <p><font size="2" color="red"><strong  tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_TRAExportacion_ErrorEnExportacionContenido_msgid',  'It was not possible to export the translations.-' )" /></font></p>
        <p tal:condition="pStatus"><font size="2" color="red"><span  tal:content="python: here.fTranslateI18N( 'gvSIGi18n', pStatus,  pStatus + '-' )" /></font></p>
        <p tal:condition="pException"><font size="1" color="red"><span  tal:content="pException" /></font></p>
    </tal:block>
</div>




<div metal:define-macro="tShowExportContentEstimation" >
    <tal:block tal:define="
        pParentExecutionRecord  pExecutionRecord  | nothing;
        pExecutionRecord        python: here.fStartExecution( 'macro', 'TRAExportar_ExportContent_interaction/tShowExportParametersEditor', pParentExecutionRecord, False);
        pPermissionsCache       pPermissionsCache | python: { };
        pRolesCache             pRolesCache       | python: { }" >
               
        <style type="text/css" >
           .TRAstyle_Clickable {
               cursor: pointer;
           }
           .TRAstyle_NoDisplay {
               display: none;
           }
           .TRAstyle_Display {
               display: run-in;
           }
           tr.TRAstyle_Display {
               display: table-row;
           }
        </style>
        
 
    
        <tal:block tal:define=" 
        
            pLanguagesExportReports     python: pExport_ExportContent_report.get( 'languages_export_reports', []);
            pExportedSeparateModules    python: pExport_ExportContent_report.get( 'separate_modules', []);" >
                               
            
      

            

            <!-- ###############################################################
            #  SECTION: Files that will be produced
            #
            # -->
             
            
            <table rules="groups"
                id="cid_FilesToProduce" class="listing" summary="Files to produce by the export"
                tal:define="global unIndexClassFila python: 0" >
                <thead>
                    <tr>
                        <th colspan="6" class="nosort" align="center">
                            <font size="2">
                                <strong tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_TRAExportacion_FilesToGenerate_msgid',   'Files to generate-' )" />
                            </font>
                            <p class="formHelp" tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_TRAExportacion_FilesToGenerate_help',   'The export process shall generate the following files, and shall pack them in a download file, according to the export configuration parameters.-' )" />
                        </th>                    
                    </tr>
                    <tr>
                        <th class="nosort" align="center" >
                            <font size="1"><strong 
                                tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_idioma_msgid',   'Language-' )" />
                            </font>
                        </th>
                        <th class="nosort" align="left">
                            <strong 
                                tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_TRAExportacion_idiomasDeReferencia_label',   'Reference Languages-' )" />
                        </th>
                        <th class="nosort" align="left">
                            <strong 
                                tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_TRAExportacion_codificacionDeCaracteres_label',   'Characters encoding-' )" />
                        </th>
                        <th class="nosort" align="left">
                            <font size="1">
                                <strong tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_modulo_msgid',   'Module-' )" />
                            </font>
                        </th>
                        <th class="nosort" align="left">
                            <font size="1">
                                <strong tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_fichero_msgid',   'File-' )" />
                            </font>
                        </th>
                        <th class="nosort" align="left">
                            <font size="1">
                                <strong tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_numeroTraducciones_abbreviated_label',   '# Translations-' )" />
                            </font>
                        </th>
                    </tr>
                </thead>
                <tal:block tal:repeat="pLanguageExportReport python: pLanguagesExportReports">
                    <tbody  tal:define="
                        pCode                       python: pLanguageExportReport.get( 'language_code', '');
                        pReferenceLanguageCode      python: pLanguageExportReport.get( 'reference_language_code', '');
                        pEncoding                   python: pLanguageExportReport.get( 'encoding', '');
                        pFilenameIfNoSeparateModules python: pLanguageExportReport.get( 'filename', '');
                        pNumTranslationsExported    python: pLanguageExportReport.get( 'translations_exported', '');
                        pModulesExportReports       python: pLanguageExportReport.get( 'modules_export_reports', []);                    
                        ">
                
                        <tal:block  tal:condition="python: pModulesExportReports or ( not pExportedSeparateModules)">
                            <tr class="#" tal:attributes="class python: pClasesFilas[unIndexClassFila % 2]">
                                <tal:block tal:define="
                                    global unIndexClassFila     python: unIndexClassFila + 1" /> 
                                
                                <td align="left" valign="top">
                                    <span  tal:content="pCode" />
                                </td>
                                <td align="left" valign="top" >
                                    <span  tal:content="pReferenceLanguageCode" />
                                </td>
                                <td align="left" valign="top" >
                                    <span tal:content="python: pEncoding"/>
                                </td>                                                        
                                <td align="center" valign="top" >
                                    <span  tal:condition="pExportedSeparateModules" tal:content="python: '%d' % len( pModulesExportReports)"/>
                                </td>
                                <td align="left" valign="top" >
                                    <span  tal:condition="not: pExportedSeparateModules" tal:content="pFilenameIfNoSeparateModules"/>
                                </td>
                                <td align="right" valign="top" >
                                    <strong tal:content="python: '%d' % pNumTranslationsExported"/>
                                </td>
                             </tr>
                        </tal:block>                               
                
                        
                        <tal:block tal:condition="pExportedSeparateModules"
                            tal:repeat="pModuleExportReport pModulesExportReports">
                            <tr tal:define="
                                    pNombreModulo                   python: pModuleExportReport.get( 'module_name', '');
                                    pFilename                       python: pModuleExportReport.get( 'filename', '');
                                    pNumTranslationsExportedModulo  python: pModuleExportReport.get( 'translations_exported', 0);"
                                class="#" tal:attributes="class python: pClasesFilas[unIndexClassFila % 2]">
                                <td colspan="3" />
                                <td align="left" valign="top" >
                                    <span tal:content="python: pNombreModulo"/>
                                </td>
                                <td align="left" valign="top" >
                                    <span tal:content="python: pFilename"/>
                                </td>
                                <td align="right" valign="top" >
                                    <span tal:content="python: '%d' % pNumTranslationsExportedModulo"/>
                                </td>
                            </tr>
                        </tal:block>
                    </tbody>
                        
                        
                </tal:block>
            </table>
            
            <br/>            
            <br/>
             
        </tal:block> 
                                            
        <tal:block tal:define="dummy python: pExecutionRecord and here.pEndExecution( pExecutionRecord)" />
    </tal:block> 
        
        
</div>







<div metal:define-macro="tPromptForEstimationReviewEditionDefaultsOrCancel" >
               
    <!-- ###############################################################
    #  SECTION: Actions available for the user:
    #
    # -->
    <a href="#" title="#"  
        tal:define="aLinkTitle python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_cancelarExportacionYVolverACatalogo_msgid',   'Cancel Export-' )"
        tal:attributes="
            title aLinkTitle;
            href python: '%s' % here.absolute_url()">
        <font size="3">
              <strong>
                  <span tal:content="aLinkTitle" />
            </strong>
        </font>
    </a>
    &emsp;
    <span class="formHelp" tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_cancelarExportacionYVolverACatalogo_help', 'Cancel translations export and navigate back to translations catalog home page.-')" />
    <br/>
    <br/>
    <br/>
    
    <a href="#" title="#"  
        tal:define="aLinkTitle python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_valoresPorDefectoExportacion_msgid',   'Default export configuration-' )"
        tal:attributes="
            title aLinkTitle;
            href python: '%s/TRAExportar/' % here.absolute_url()">
        <font size="3">
              <strong>
                  <span tal:content="aLinkTitle" />
            </strong>
        </font>
    </a>
    &emsp;
    <span class="formHelp" tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_valoresPorDefectoExportacion_help', 'Discard any changes made to export configuration parameters, and start again with the values configured in the translations catalog and languages.-')" />
    <br/>
    <br/>
    <br/>
    
    <input type="button" value="#"
        tal:attributes="value python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_configurarExportacion_msgid',   'Edit parameters-' )"    
        onclick="document.getElementById('theRequestedAction').value='EditParameters'; document.forms[ 'cid_TRAExportar_form'].submit(); return true;" 
        style="color: red; font-size: 9pt; font-style: italic; font-weight: 700" />
    &emsp;
    <span class="formHelp"  tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_configurarExportacion_help',  'Edit the export configuration paramters.-' )" />
    <br/>
    <br/>
  
   
    <input type="button" value="#"
        tal:attributes="value python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_revisarExportacion_action_label',   'Review Export-' )"    
        onclick="document.getElementById('theRequestedAction').value='ReviewParameters'; document.forms[ 'cid_TRAExportar_form'].submit(); return true;" 
        style="color: red; font-size: 9pt; font-style: italic; font-weight: 700" />
    &emsp;
    <span class="formHelp"  tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_revisarExportacion_action_help',  'Review the content selected for export, and then confirm or cancel the export.-' )" />
    <br/>
    <br/>

            
   <input type="button" value="#"
        tal:attributes="value python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_estimarExportacion_action_label',   'Estimate Export-' )"    
        onclick="document.getElementById('theRequestedAction').value='EstimateContent'; document.forms[ 'cid_TRAExportar_form'].submit(); return true;" 
        style="color: red; font-size: 9pt; font-style: italic; font-weight: 700" />
    &emsp;
    <span class="formHelp"  tal:content="python: here.fTranslateI18N( 'gvSIGi18n', 'gvSIGi18n_estimarExportacion_action_help',  'The system will estimate the content that will be included in the exported download file.-' )" />
    <br/>
    <br/>
           
           
</div>

                         

</body>
</html>
