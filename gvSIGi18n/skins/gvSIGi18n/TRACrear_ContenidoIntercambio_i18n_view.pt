<tal:block replace="nothing">
# File: TRACrear_ContenidoIntercambio_i18n_view.pt
# Copyright (c) 2008, 2009 by Conselleria de Infraestructuras y Transporte de la
# Generalidad Valenciana
#
# GNU General Public License (GPL)
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA.
#
# Authors: 
# Conselleria de Infraestructuras y Transporte de la Generalidad Valenciana 
# Model Driven Development sl  Valencia (Spain) www.ModelDD.org 
# Antonio Carrasco Valero                       carrasco@ModelDD.org
#
</tal:block>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en">
<body>


    <div metal:define-macro="tTRACrear_ContenidoIntercambio_i18n_view" >
	
	
        <metal:block metal:use-macro="here/PerformanceAnalysis/macros/tSetupPerformanceAnalysis" />   

        <tal:block tal:define="
                pNewTypeName				request/theNewTypeName        | string:;		
                pAggregationName			request/theAggregationName    | string:;
				pUploadedFile				request/form/theUploadedFile			| python: None;
				pDefaultLanguageCode        python: request.get( 'theDefaultLanguage', here.getCatalogo().fCodigoIdiomaPorDefecto()) or '';
         global pMostrarFormulario			python: (not pUploadedFile) ;
                pTrue						python: True;
                pFalse						python: False;
				pPermissionsCache			python: { };
				pRolesCache					python: { };
				pParentExecutionRecord		pExecutionRecord | nothing;">
                
				
                    
			<tal:block tal:condition="not: pUploadedFile" >
				<form name="Crear_TRAContenidoIntercambio" method="post" enctype="multipart/form-data">
				
                                       
					<input originalvalue="#" name="theNewTypeName" value="#" type="hidden"
						tal:attributes="originalvalue python: pNewTypeName;value python: pNewTypeName" />
						
					<input originalvalue="#" name="theAggregationName" value="#" type="hidden"
						tal:attributes="originalvalue python: pAggregationName;value python: pAggregationName" />
						
    			    <h3  i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_action_page_title">Crear contenido de traducciones a importar desde fichero-</h3>
    			    <br/>
    			    <p  i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_action_selectFile">Seleccione un fichero con traducciones a importar y pulse el boton guardar.-</p>
    			    <p  i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_action_selectFile2">El contenido del fichero debe corresponder a ficheros de localicacion Java .properties o GNU gettext .po.-</p>
    			    <p  i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_action_selectFile3">Uno o varios de estos ficheros pueden estar archivados (y posiblemente comprimidos) con formato .zip (por ejemplo, .zip o .jar).-</p>
                    <br/>			    
						
    			    <p><strong  i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_DefaultLanguage_label">Idioma por defecto-</strong></p>
    			    <p  class="formHelp" i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_DefaultLanguage_help">Idioma por defecto, si importa un fichero "text.properties", y no esta en un ".zip" o ".jar" o no tiene MANIFEST.MF-</p>
                    
                    <input name="theDefaultLanguage" id="theDefaultLanguage" value="#" tal:attributes="value python: pDefaultLanguageCode"/> 					

					<br/>
					<br/>

    			    <p><strong i18n:domain="gvSIGi18n" i18n:translate="gvSIGi18n_crearContenidoAImportar_fichero_label">Fichero a importar-</strong></p>
					
					<input name="theUploadedFile" type="file" />
					
					<br/>
					<br/>
						
					<input class="context" name="form_submit"  type="submit"  value="Save"  i18n:domain="plone" i18n:attributes="value label_save" />                                                        
				</form>
			</tal:block>
				
                                                                       
            <tal:block tal:condition="pUploadedFile" >
			
                <tal:block tal:define="
					pUseCaseAssessmentResult python: here.fUseCaseAssessment( 
                        theUseCaseName          = 'Create_TRAContenidoIntercambio', 
                        theElementsBindings     = { 'object': here,},
                        theRulesToCollect       = None, 
                        thePermissionsCache     = pPermissionsCache, 
                        theRolesCache           = pRolesCache, 
                        theParentExecutionRecord= pExecutionRecord);
					pPermiteCrear python: pUseCaseAssessmentResult and pUseCaseAssessmentResult.get( 'success', False)" >
					<tal:block tal:condition="pPermiteCrear" >
		
						<tal:block tal:define="    
							pRetrievalStartTime  python: here.ModelDDvlPlone_tool.fMillisecondsNow();                
							pProfilingResults python: (pPerformanceAnalysis or {}).get( 'profiling_results', None);                
							unosArgs python: { 
								'theTimeProfilingResults'     :pProfilingResults,
								'theElement'                  :here, 
								'theParent'                   :None,
								'theParentTraversalName'      :'',
								'theTypeConfig'               :None, 
								'theAllTypeConfigs'           :None, 
								'theViewName'                 :'Tabular', 
								'theRetrievalExtents'         :[ 'traversals', 'owner', ],
								'theWritePermissions'         :[ 'object', 'aggregations', 'add', 'add_collection', ],
								'theFeatureFilters'           :{ 'aggregations': [ pAggregationName,], 'relations': [], }, 
								'theInstanceFilters'          :None,
								'theTranslationsCaches'       :None,
								'theCheckedPermissionsCache'  :None,
								'theAdditionalParams'         :None, };                      
							SRES  python: here.ModelDDvlPlone_tool.fRetrieveTypeConfig( **unosArgs);
							pRetrievalEndTime  python: here.ModelDDvlPlone_tool.fMillisecondsNow();
							unasTraversals python: [ unaTraversal for unaTraversal in SRES[ 'traversals'] if (unaTraversal[ 'traversal_kind'] == 'aggregation') and ( unaTraversal[ 'traversal_name'] == pAggregationName)]" 
							tal:condition="unasTraversals" >
							
							<metal:block metal:use-macro="here/PerformanceAnalysis/macros/tRenderRetrievalTime_HTML" />   
							
							
							<tal:block tal:define="
								unaTraversal python: unasTraversals[ 0]; 
								unasFactories python: [ unaFactory for unaFactory in unaTraversal[ 'factories'] if unaFactory[ 'meta_type'] == pNewTypeName]"
								tal:condition="unasFactories">
						   
								<tal:block tal:define="
									unaFactory python: unasFactories[ 0]" 
									tal:condition="unaFactory" >
																
									<tal:block tal:define="
										pPermiteAbandonarCrear      pTrue;
										pShowTrees                  pFalse;
										pShowOrHideTrees            pFalse;
										pPermiteEditar              pFalse;
										pPermiteEliminar            pFalse;
										pMostrarAnteriorPosterior   pFalse;
										pPaginaAnteriorPosterior    string:;
										pPagina                     string:Tabular;
										pAbandonarAnchorName        string:#aggregation-${pAggregationName}" >                            
										<metal:block metal:use-macro="here/CabeceraEnTabla_i18n_view/macros/tCabeceraEnTabla_i18n" />   
									</tal:block>
						
									<h2>
										<span i18n:domain="ModelDDvlPlone" i18n:translate="ModelDDvlPlone_crear_action_label">Crear nuevo elemento&nbsp;</span>
										&nbsp;  
										(      
										<img src="#" tal:attributes="src python: '%s/%s.gif' % (here.absolute_url(), unaFactory[ 'meta_type'].lower())"  
											alt="" title="New Typeicon" id="icon-new type" />
										<span tal:content="unaFactory/type_translations/translated_archetype_name" />    
										)
										&nbsp; 
										<span i18n:domain="ModelDDvlPlone" i18n:translate="ModelDDvlPlone_ensiguecontenedorcuandocreando">&nbsp;en&nbsp;</span>
										<tal:block tal:condition="SRES/is_collection" >
											<span tal:content="SRES/values_by_name/title/value" />
											&nbsp;(
											<img src="#" tal:attributes="src python: '%s/%s' % (here.absolute_url(), SRES[ 'content_icon'])"  
												 alt="" title="here icon" id="icon-here" />
											&nbsp;
											<span i18n:translate="" tal:content="SRES/type_translations/translated_archetype_name" />
											)
											&nbsp; 
											<span i18n:domain="ModelDDvlPlone" i18n:translate="ModelDDvlPlone_colecciondesiguecontenedorcuandocreando">&nbsp;de&nbsp;</span>                                   
											&nbsp; 
											<span tal:content="SRES/owner_element/values_by_name/title/value" />
											&nbsp;(
											<img src="#" tal:attributes="src python: '%s/%s' % ( here.absolute_url(), SRES[ 'owner_element'][ 'content_icon'])"  
												 alt="" title="Propietario MetaType icon" id="icon-propietario" />
											&nbsp;
											<span tal:content="SRES/owner_element/type_translations/translated_archetype_name" />
											)
										</tal:block>                                
										<tal:block tal:condition="not: SRES/is_collection" >
											<span tal:content="SRES/values_by_name/title/value" />
											&nbsp;(
											<img src="#" tal:attributes="src python: '%s/%s' % (here.absolute_url(), SRES[ 'content_icon'])"  
												 alt="" title="here icon" id="icon-here" />
											&nbsp;
											<span i18n:translate="" tal:content="SRES/type_translations/translated_archetype_name" />
											)
										</tal:block>                                
									</h2>
								   
									<p class="formHelp"  tal:content="unaFactory/type_translations/translated_type_description" />        
									<br/>
									<br/>
								
									
									<tal:block tal:define="
										pProfilingResults python: (pPerformanceAnalysis or {}).get( 'profiling_results', None);
										someAdditionalParams python: {
											'theUploadedFile'         :pUploadedFile,  }; 
										unosArgs python: {
											'theTimeProfilingResults' :pProfilingResults,
											'theContainerElement'     :here, 
											'theTypeName'             :pNewTypeName, 
											'theId'                   :None,
											'theTitle'                :'A Sustituir', 
											'theDescription'          :'',
											'theAdditionalParams'     :someAdditionalParams,
											'theAllowFactoryMethods'  :True,};   
										pCrearResult python: here.ModelDDvlPlone_tool.fCrearElementoDeTipo( **unosArgs)" >
										<tal:block tal:condition="python: pCrearResult and ( pCrearResult[ 'effect'] == 'created')" >
											<tal:block tal:define="
												dummy python:request.response.redirect( '%sEditar/' % pCrearResult[ 'new_object_result'][ 'url']);" />
										</tal:block>
										<tal:block tal:condition="python: not ( pCrearResult) or not ( pCrearResult[ 'effect'] == 'created')" >
											<h4>
												<font color="Red">
													<span i18n:domain="ModelDDvlPlone"  i18n:translate="ModelDDvlPlone_nosehacreadoelemento_info_msgid" >ModelDDvlPlone_nosehacreadoelemento_info_msgid</span>
												</font>
											</h4>
											<p>
												<font color="Red">
													<span tal:condition="python: pCrearResult[ 'failure'] in [ 'duplicate_title',]"
														i18n:domain="ModelDDvlPlone"  i18n:translate="ModelDDvlPlone_tituloduplicado_error_msgid" >ModelDDvlPlone_tituloduplicado_error_msgid
														<tal:block tal:define="global pMostrarFormulario pTrue" />
													</span>
													<span tal:condition="python: pCrearResult[ 'failure'] in [ 'read_permission', 'write_permission',]"
														i18n:domain="ModelDDvlPlone"  i18n:translate="ModelDDvlPlone_sinpermisoparacrear_error_message" >ModelDDvlPlone_sinpermisoparacrear_error_message</span>
													<span tal:condition="python: pCrearResult[ 'failure'] in [ 'content_type_not_allowed', ]"
														i18n:domain="ModelDDvlPlone"  i18n:translate="ModelDDvlPlone_nosepuedecreartipocontenido_error_message" >ModelDDvlPlone_nosepuedecreartipocontenido_error_message</span>
													<span tal:condition="python: pCrearResult[ 'failure'] in [ 'factory_failure', ]"
														i18n:domain="ModelDDvlPlone"  i18n:translate="ModelDDvlPlone_creandocontenido_error_message" >ModelDDvlPlone_creandocontenido_error_message</span>
													<span tal:condition="python: not( pCrearResult[ 'failure'] in [ 'duplicate_title', 'factory_failure', 'read_permission', 'write_permission',  'content_type_not_allowed',  'factory_failure', ])"
														i18n:domain="ModelDDvlPlone"  i18n:translate="" tal:content="pCrearResult/failure" />
	
												</font>
											</p>
										</tal:block>
									</tal:block>
								</tal:block>
							</tal:block>
						</tal:block>
					</tal:block>						
					<tal:block tal:condition="not: pPermiteCrear" >
						<br>
						<h2 > 
							<a  href="#" tal:attributes="href python: '%sTabular/' % SRES[ 'url']" class="state-visible" title="">
								<font color="Red">                    
									<span  i18n:domain="ModelDDvlPlone" i18n:translate="ModelDDvlPlone_sinpermisoparacrear_error_message"/>
									&nbsp;
									<span tal:content="unaFactory/type_translations/translated_archetype_name" />
									&nbsp;
									<span  i18n:domain="ModelDDvlPlone" i18n:translate="ModelDDvlPlone_ensiguecontenedorcuandocreando"/>
									&nbsp;
									<span tal:content="SRES/values_by_name/title/uvalue " />
									&nbsp;(                    
									<img src="#" tal:attributes="src python: '%s/%s' % (here.absolute_url(), SRES[ 'content_icon'])"  
										 alt="" title="MetaType icon" id="icon-here" />
									&nbsp;
									<span tal:content="SRES/type_translations/translated_archetype_name" />
									)                        
								</font>
							</a>                
						</h2>      
					</tal:block>				
				</tal:block>
            </tal:block>
        </tal:block>
		
        <metal:block metal:use-macro="here/PerformanceAnalysis/macros/tRenderProcessingTime_HTML" />   
             
    </div>
    

</body>
</html>

